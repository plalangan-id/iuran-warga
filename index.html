<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Iuran Plalangan</title>
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/1160/1160329.png">
    <style>
        :root { --primary: #27ae60; --danger: #e74c3c; --bg: #f4f7f6; --card-bg: #ffffff; --text-main: #2c3e50; }
        body.dark-mode { --bg: #121212; --card-bg: #1e1e1e; --text-main: #e0e0e0; }
        body { background-color: var(--bg); font-family: sans-serif; margin: 0; padding: 15px; color: var(--text-main); transition: 0.3s; }
        .container { max-width: 500px; margin: auto; }
        .header-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .btn-mode { background: var(--card-bg); border: 1px solid #ccc; padding: 7px 12px; border-radius: 20px; cursor: pointer; color: var(--text-main); font-size: 11px; }
        .box-info { background: #fff9c4; color: #333; padding: 12px; border-radius: 10px; margin-bottom: 15px; border-left: 5px solid #fbc02d; font-size: 13px; display: none; }
        body.dark-mode .box-info { background: #332b00; color: #fff; }
        .search-box { background: var(--card-bg); padding: 15px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; text-align: center; background: var(--card-bg); color: var(--text-main); box-sizing: border-box; }
        .warga-nama { text-align: center; margin-bottom: 15px; display: none; padding: 10px; background: var(--card-bg); border-radius: 10px; border-bottom: 4px solid var(--primary); }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .item-bulan { background: var(--card-bg); padding: 12px; border-radius: 10px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 2px solid transparent; }
        .lunas { border-color: var(--primary); background: #ebfaef; color: var(--primary); }
        body.dark-mode .lunas { background: #0a2e17; }
        .belum { border-color: var(--danger); background: #fdf2f2; color: var(--danger); }
        body.dark-mode .belum { background: #3a1111; }
        .tgl { font-size: 9px; display: block; margin-top: 4px; opacity: 0.8; }
        .kas { background: var(--card-bg); padding: 15px; border-radius: 15px; margin-top: 20px; text-align: center; border: 1px solid #ddd; }
        .kas h2 { margin: 5px 0; color: var(--primary); }
    </style>
</head>
<body>

<div class="container">
    <div class="header-nav">
        <strong>üè° Plalangan Digital</strong>
        <button class="btn-mode" onclick="modeGanti()" id="btnM">üåô Mode Gelap</button>
    </div>

    <div id="pBox" class="box-info">
        <strong>üì¢ INFO:</strong> <span id="pText"></span>
    </div>

    <div class="search-box">
        <input type="text" id="inNama" placeholder="Ketik Nama Anda..." onkeyup="prosesCari()">
    </div>

    <div id="wBox" class="warga-nama">
        <h3 id="wNama" style="margin:0;"></h3>
    </div>

    <div class="grid" id="gBulan"></div>

    <div class="kas">
        <small>Total Kas (2026)</small>
        <h2 id="tKas">Rp 0</h2>
    </div>
</div>

<script>
    const linkCSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSqOacaVgTEVIQdIOgsacKIqQtqfTqUH5F_UMoI5R6ci5fxg2Px6BHrdlfntfdR7Md7Z3TshmUHtG7V/pub?gid=0&single=true&output=csv';

    function modeGanti() {
        document.body.classList.toggle('dark-mode');
        document.getElementById('btnM').innerText = document.body.classList.contains('dark-mode') ? "‚òÄÔ∏è Mode Terang" : "üåô Mode Gelap";
    }

    async function ambilData() {
        try {
            const r = await fetch(linkCSV + '&v=' + new Date().getTime());
            const s = await r.text();
            const baris = s.split(/\r?\n/);
            window.semuaBaris = baris;

            // F = Index 5 (Pengumuman)
            const k = baris[1].split(",");
            if(k[5]) {
                document.getElementById('pBox').style.display = "block";
                document.getElementById('pText').innerText = k[5].replace(/"/g, '');
            }

            // E = Index 4 (Nominal)
            let total = 0;
            for(let i=1; i<baris.length; i++) {
                const c = baris[i].split(",");
                if(c[4]) total += parseInt(c[4].replace(/[^0-9]/g, '')) || 0;
            }
            document.getElementById('tKas').innerText = "Rp " + total.toLocaleString('id-ID');
        } catch (e) { console.log("Gagal"); }
    }

    function prosesCari() {
        const cari = document.getElementById('inNama').value.toLowerCase().trim();
        const g = document.getElementById('gBulan');
        const w = document.getElementById('wBox');

        if(cari.length < 3) { g.innerHTML = ""; w.style.display = "none"; return; }

        let hasil = [];
        let namaKetemu = "";

        window.semuaBaris.forEach((brs, i) => {
            if(i === 0) return;
            const c = brs.split(",").map(v => v.replace(/"/g, '').trim());
            // C = Index 2 (Nama) | D = Index 3 (Bulan) | B = Index 1 (Tanggal)
            if(c[2] && c[2].toLowerCase().includes(cari)) {
                hasil.push({ bln: c[3], tgl: c[1] });
                namaKetemu = c[2].toUpperCase();
            }
        });

        if(hasil.length > 0) {
            w.style.display = "block";
            document.getElementById('wNama').innerText = namaKetemu;
            const listBln = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
            g.innerHTML = "";
            listBln.forEach(b => {
                const d = hasil.find(h => h.bln === b);
                const div = document.createElement('div');
                div.className = `item-bulan ${d ? 'lunas' : 'belum'}`;
                div.innerHTML = `<strong>${b}</strong><br><span style="font-size:20px">${d ? '‚úÖ' : '‚ùå'}</span><br><small>${d ? 'LUNAS' : 'BELUM'}</small>${d ? `<span class="tgl">${d.tgl}</span>` : ''}`;
                g.appendChild(div);
            });
        }
    }
    ambilData();
</script>
</body>
</html>
